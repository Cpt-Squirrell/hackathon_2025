<html>
<head>
	<title>Spyfall</title>
	<style>
		body {
			padding: 5%;
		}
		
		.hidden {
			display: none;
		}
	</style>
	<script>
		function StartGame() {
			const lobby = document.getElementById("lobby").value;
			const player = document.getElementById("player").value;
			const contestants = document.getElementById("contestants").value;
			
			// Very simple input validation courtesy of ChatGPT    
            if (!/^[\x30-\x7A]+$/.test(lobby)) {
                alert("Invalid lobby name.");
                return;
            }

            if (isNaN(contestants) || contestants < 3 || contestants > 12) {
                alert("Number of contestants must be between 3 and 12.");
                return;
            }
			
			if (isNaN(player) || player < 1 || player > contestants) {
                alert("Player number must be a number between 1 and the number of contestants.");
                return;
            }
			
			let request = new XMLHttpRequest();
			request.onreadystatechange = function () {
				if (request.readyState != XMLHttpRequest.DONE || request.status != 200) { return }
				const data = JSON.parse(request.response);
				const newLobby = data.lobby;
				const location = data.location;
				const role = data.role;
				const locations = data.locations;
				const locationSpan = document.getElementById("location");
				const roleSpan = document.getElementById("role");
				locationSpan.innerText = location;
				roleSpan.innerText = role;
				document.getElementById("lobby").value = newLobby;
				document.getElementById("locationTitle").classList.remove("hidden");
				document.getElementById("roleTitle").classList.remove("hidden");
				const locationList = document.getElementById("locations");
				locationList.innerHTML = "";
				locations.forEach((loc) => {
					const item = document.createElement('li');
					item.appendChild(document.createTextNode(loc));
					locationList.appendChild(item);
				});
			}
			request.open("POST", "/");
			request.setRequestHeader("Content-type", "application/json");
			request.send(JSON.stringify({"lobby": lobby, "player": player, "contestants": contestants}));
		}

	</script>
</head>

<body>
	<h1>Spyfall</h1>
	<form method="post" onsubmit="StartGame(); return false">
		<input id="lobby" name="lobby" type="text" placeholder="Lobby ID" \>
		<input id="player" name="player" type="text" placeholder="Player ID" \>
		<input id="contestants" name="contestants" type="text" placeholder="Nr. of players" \>
		<input type="submit" value="Start new game" \>
	</form>
	<hr>
	<b id="locationTitle" class="hidden">Location: </b>
	<span id="location"></span>
	&nbsp;&nbsp;&nbsp;&nbsp;
	<b id="roleTitle" class="hidden">Your role: </b>
	<span id="role"></span>
	<ol id="locations"></ol>

</body>
</html>